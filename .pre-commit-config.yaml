repos:
  # Prettier for code formatting
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        name: Format code with Prettier
        files: \.(json|md|yml|yaml)$

  # General pre-commit hooks for basic checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
        name: Trim trailing whitespace
      - id: end-of-file-fixer
        name: Fix end of files
      - id: check-yaml
        name: Check YAML
      - id: check-json
        name: Check JSON
      - id: check-added-large-files
        name: Check for large files

  # Forge formatting for Solidity files
  - repo: local
    hooks:
      - id: forge-fmt
        name: Format Solidity with Forge
        entry: forge fmt
        language: system
        files: \.sol$
        pass_filenames: false

  # Forge build check to ensure contracts compile
  - repo: local
    hooks:
      - id: forge-build
        name: Build contracts with Forge
        entry: forge build
        language: system
        files: \.sol$
        pass_filenames: false

  # Quick test runner for fast feedback
  - repo: local
    hooks:
      - id: forge-test-quick
        name: Run quick Forge tests
        entry: forge test --gas-report
        language: system
        files: \.sol$
        pass_filenames: false

  # Security analysis tools integrated into pre-commit workflow

  # Solhint linting for Solidity security
  - repo: local
    hooks:
      - id: solhint
        name: Solidity linting with Solhint
        entry: npx solhint
        language: system
        files: \.sol$
        args: ["src/**/*.sol", "test/**/*.sol"]
        pass_filenames: false

  # Detect secrets and sensitive information
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        name: Detect secrets
        args: ["--baseline", ".secrets.baseline"]
        exclude: package-lock.json

  # Slither static analysis (quick scan for pre-commit)
  - repo: local
    hooks:
      - id: slither-quick
        name: Quick Slither analysis
        entry: bash
        language: system
        files: \.sol$
        pass_filenames: false
        args:
          [
            "-c",
            'if command -v slither >/dev/null 2>&1; then slither . --exclude-dependencies --disable-color; else echo "Warning: Slither not available, skipping analysis"; fi',
          ]

# Configuration for pre-commit behavior
fail_fast: false
default_stages: [pre-commit]

# Minimum pre-commit version required
minimum_pre_commit_version: "3.0.0"
