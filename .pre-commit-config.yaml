repos:
  # Prettier for code formatting
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        name: Format code with Prettier
        files: \.(json|md|yml|yaml)$
        exclude: ^(node_modules/|lib/|cache/|out/|crytic-export/).*

  # General pre-commit hooks for basic checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
        name: Trim trailing whitespace
        exclude: ^(node_modules/|lib/|cache/|out/|crytic-export/).*
      - id: end-of-file-fixer
        name: Fix end of files
        exclude: ^(node_modules/|lib/|cache/|out/|crytic-export/).*
      - id: check-yaml
        name: Check YAML
        exclude: ^(node_modules/|lib/|cache/|out/|crytic-export/).*
      - id: check-json
        name: Check JSON
        exclude: ^(node_modules/|lib/|cache/|out/|crytic-export/).*
      - id: check-added-large-files
        name: Check for large files
        exclude: ^(node_modules/|lib/|cache/|out/|crytic-export/).*

  # Forge formatting for Solidity files
  - repo: local
    hooks:
      - id: forge-fmt
        name: Format Solidity with Forge
        entry: forge fmt
        language: system
        files: \.sol$
        pass_filenames: false

  # Forge build check to ensure contracts compile
  - repo: local
    hooks:
      - id: forge-build
        name: Build contracts with Forge
        entry: forge build
        language: system
        files: \.sol$
        pass_filenames: false

  # Adaptive test runner for environment-aware testing
  - repo: local
    hooks:
      - id: adaptive-test-quick
        name: Run adaptive quick tests
        entry: bash
        language: system
        files: \.sol$
        pass_filenames: false
        args:
          [
            "-c",
            'FOUNDRY_PROFILE=quick ./adaptive-test-runner.sh core || echo "Warning: Quick test timeout (normal for pre-commit)"',
          ]

  # Security analysis tools integrated into pre-commit workflow

  # Property-based testing with Echidna (optimized for pre-commit)
  - repo: local
    hooks:
      - id: echidna-quick
        name: Quick Echidna property testing
        entry: bash
        language: system
        files: \.sol$
        pass_filenames: false
        args:
          [
            "-c",
            'export PATH="/home/justin/.local/bin:$PATH"; if command -v echidna >/dev/null 2>&1; then timeout 20 echidna test/echidna/SimpleTest.sol --contract SimpleTest --test-limit 50 --seq-len 5 || echo "Warning: Echidna timeout (normal for pre-commit)"; else echo "Warning: Echidna not available, skipping property tests"; fi',
          ]

  # Quick fuzz testing for critical functions
  - repo: local
    hooks:
      - id: forge-fuzz-quick
        name: Quick fuzz testing
        entry: bash
        language: system
        files: \.sol$
        pass_filenames: false
        args:
          [
            "-c",
            'timeout 15 forge test --match-test "fuzz" --fuzz-runs 100 || echo "Warning: Quick fuzz test timeout (normal for pre-commit)"',
          ]

  # Scribble instrumentation check (lightweight)
  - repo: local
    hooks:
      - id: scribble-check
        name: Scribble annotation validation
        entry: bash
        language: system
        files: \.sol$
        pass_filenames: false
        args:
          [
            "-c",
            'if command -v npx >/dev/null 2>&1; then timeout 10 npx scribble --check src/ScribbleValidationContract.sol 2>/dev/null || echo "Warning: Scribble check skipped (file may not exist)"; else echo "Warning: npm/npx not available"; fi',
          ]

  # Solhint linting for Solidity security
  - repo: local
    hooks:
      - id: solhint
        name: Solidity linting with Solhint
        entry: npx solhint
        language: system
        files: \.sol$
        args: ["src/**/*.sol", "test/**/*.sol"]
        pass_filenames: false

  # Detect secrets and sensitive information
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        name: Detect secrets
        args: ["--baseline", ".secrets.baseline"]
        exclude: ^(node_modules/|lib/|cache/|out/|crytic-export/|package-lock\.json).*

  # Slither static analysis (quick scan for pre-commit)
  - repo: local
    hooks:
      - id: slither-quick
        name: Quick Slither analysis
        entry: bash
        language: system
        files: \.sol$
        pass_filenames: false
        args:
          [
            "-c",
            'if command -v slither >/dev/null 2>&1; then timeout 8 slither . --exclude-dependencies --disable-color --filter-paths "test/,lib/" || echo "Warning: Slither timeout (normal for pre-commit)"; else echo "Warning: Slither not available, skipping analysis"; fi',
          ]

  # Extended property testing for pre-push stage
  - repo: local
    hooks:
      - id: echidna-extended
        name: Extended Echidna property testing
        entry: bash
        language: system
        files: \.sol$
        pass_filenames: false
        stages: [pre-push, manual]
        args:
          [
            "-c",
            'export PATH="/home/justin/.local/bin:$PATH"; if command -v echidna >/dev/null 2>&1; then timeout 120 echidna test/echidna/SimpleTest.sol --contract SimpleTest --test-limit 1000 --seq-len 10 || echo "Warning: Extended Echidna timeout"; else echo "Warning: Echidna not available"; fi',
          ]

  # Extended fuzz testing for pre-push stage
  - repo: local
    hooks:
      - id: forge-fuzz-extended
        name: Extended fuzz testing
        entry: bash
        language: system
        files: \.sol$
        pass_filenames: false
        stages: [pre-push, manual]
        args:
          [
            "-c",
            'timeout 90 forge test --match-test "fuzz" --fuzz-runs 5000 || echo "Warning: Extended fuzz test timeout"',
          ]

  # Full Scribble validation for manual stage
  - repo: local
    hooks:
      - id: scribble-full
        name: Full Scribble specification validation
        entry: bash
        language: system
        files: \.sol$
        pass_filenames: false
        stages: [manual]
        args:
          [
            "-c",
            'if command -v npx >/dev/null 2>&1; then make scribble-validation-test || echo "Warning: Full Scribble validation issues"; else echo "Warning: npm/npx not available"; fi',
          ]

# Configuration for pre-commit behavior
fail_fast: false
default_stages: [pre-commit]

# Minimum pre-commit version required
minimum_pre_commit_version: "3.0.0"
